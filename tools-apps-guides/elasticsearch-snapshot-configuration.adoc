---
permalink: tools-apps-guides/elasticsearch-snapshot-configuration.html 
sidebar: sidebar 
keywords: Elastic, Elasticsearch, snapshot, repository, StorageGRID, object storage 
summary: StorageGRID 개체 스토리지를 사용하기 위해 Elasticsearch 스냅샷 저장소를 만드는 방법에 대한 지침입니다. 
---
= Elasticsearch 스냅샷 저장소 구성
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
안젤라 청 _ 에 의해

Elasticsearch는 스냅샷 저장소에 AWS S3 호환 개체 스토리지를 사용하는 것을 지원합니다.  이 문서에서는 StorageGRID 백엔드 개체 스토리지로 사용하여 Elasticsearch S3 스냅샷 저장소를 만드는 방법에 대한 단계별 지침을 제공합니다.



== 요구 사항

* StorageGRID 11.8 이상
* Elasticsearch 8.x 이상




== 가정

독자는 StorageGRID 와 Elasticsearch의 용어와 운영에 익숙합니다.



== 지침

* 단계 *

. Elasticsearch 스냅샷 저장소에 사용할 StorageGRID 버킷을 만듭니다.  버킷 버전 관리를 활성화해야 합니다.  저장소당 버킷 하나를 사용하세요.  여러 저장소나 Elasticsearch 클러스터에서 버킷을 공유하지 마세요.
. Elasticsearch 키스토어에 StorageGRID 테넌트 액세스 키와 비밀 키를 추가합니다.  Elasticsearch 마스터 노드에 로그인하고 다음으로 이동합니다. `<elasticsearch>/bin/` 디렉토리 및 사용 `elasticsearch-keystore` 액세스 키와 비밀 키를 추가합니다.
+
샘플 명령:

+
[NOTE]
====
 In older Elasticsearch versions, the key names are `access.key` and `secret.key` instead of using underscores.
====
+
[listing]
----
/usr/share/elasticsearch/bin/elasticsearch-keystore add s3.client.sgdemo.access_key
Enter value for s3.client.sgdemo.access_key: <paste the access key here, it will not be displayed>

/usr/share/elasticsearch/bin/elasticsearch-keystore add s3.client.sgdemo.secret_key
Enter value for s3.client.sgdemo.secret_key: <paste the secret key here, it will not be displayed>
----
+
키를 표시하려면 'elasticsearch-keystore show <키 이름>' 명령을 사용하세요.

. 다중 노드 Elasticsearch 클러스터의 경우 각 노드에서 2단계를 반복하거나 Elasticsearch 설명서를 참조하세요.
. Kibana 웹 GUI에서 Dev Tools 콘솔 페이지로 이동하여 다음을 사용합니다. `POST _nodes/reload_secure_settings` 각 노드에 변경 사항을 적용하는 API입니다.
+
image:es-snapshot/es-reload-api.png["reload_secure_settings 샘플 스크린샷"]

. 사용하세요 `PUT _snapshot` 새로운 스냅샷 저장소를 만드는 API입니다.
+
이 예에서 저장소 이름은 다음과 같습니다. `sg_snapshot_repository` 그리고 버퍼 크기는 S3 멀티파트 업로드 파트 크기에 해당합니다.

+
기본 프로토콜은 HTTPS입니다.  StorageGRID S3 엔드포인트와 함께 HTTP를 사용하려면 다음을 추가하세요. `"protocol": "http"` 설정으로.

+
1단계에서 만든 버킷 이름과 2단계에서 구성한 클라이언트 이름을 사용하세요.

+
[listing]
----
PUT _snapshot/sg_snapshot_repository
{
  "type": "s3",
  "settings": {
    "bucket": "elk-snapshot",
    "client": "sgdemo",
    "path_style_access": "true",
    "endpoint": "sgdemo.netapp.com",
    "buffer_size": "512mb"
  }
}
----
+
image:es-snapshot/es-create-repository-api.png["Elasticsearch API 샘플 스크린샷"]

. Kibana 웹 GUI에서 스택 관리 > 스냅샷 및 복원 페이지로 이동하여 저장소 탭을 선택합니다.
+
저장소 이름을 클릭하면 세부 정보를 보거나 Elasticsearch 노드당 초당 최대 스냅샷 바이트(기본값 40MB/초)와 같은 일부 설정을 수정할 수 있습니다.

+
이 페이지에 표시되지 않는 설정의 경우 다음을 사용하세요. `PUT _snapshot` Dev Tools 콘솔의 API를 사용하여 변경 사항을 적용합니다.

+
image:es-snapshot/es-snapshot-repository.png["스냅샷 저장소 샘플 스크린샷"]

. 스냅샷 버킷에서 최신 버전이 아닌 객체를 관리하기 위해 버킷 수명 주기 정책을 설정합니다.  예를 들어, 90일 후에 최신이 아닌 버전을 제거합니다.
. Elastic에서는 스냅샷을 저장하기 전에 클라이언트가 AWS S3가 아닌 스토리지를 검증하도록 요구합니다.
+
Elastic 지침에 따라 설정을 검증하세요.

+
https://www.elastic.co/docs/api/doc/elasticsearch/operation/operation-snapshot-repository-analyze[]

. 검증 후 Elasticsearch 가이드에 따라 매일 밤 스냅샷을 저장하기 위한 정책을 생성합니다.




== 추가 리소스

* https://www.elastic.co/docs/api/doc/elasticsearch/group/endpoint-snapshot["Elasticsearch S3 저장소"]
* https://docs.netapp.com/us-en/storagegrid/ilm/how-objects-are-deleted.html#delete-s3-versioned-objects["S3 버전이 지정된 객체가 삭제되는 방식"]

